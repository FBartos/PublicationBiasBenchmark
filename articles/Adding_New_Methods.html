<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Adding New Methods • PublicationBiasBenchmark</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adding New Methods">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PublicationBiasBenchmark</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-results" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Results</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-results">
<li><a class="dropdown-item" href="../articles/Results.html">Overall</a></li>
    <li><a class="dropdown-item" href="../articles/Results_Stanley2017.html">Stanley2017</a></li>
    <li><a class="dropdown-item" href="../articles/Results_Carter2019.html">Carter2019</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-extending-the-benchmark" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Extending the Benchmark</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-extending-the-benchmark">
<li><a class="dropdown-item" href="../articles/Adding_New_DGMs.html">Adding New DGMs</a></li>
    <li><a class="dropdown-item" href="../articles/Adding_New_Methods.html">Adding New Methods</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/FBartos/PublicationBiasBenchmark/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Adding New Methods</h1>
                        <h4 data-toc-skip class="author">František
Bartoš</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/FBartos/PublicationBiasBenchmark/blob/master/vignettes/Adding_New_Methods.Rmd" class="external-link"><code>vignettes/Adding_New_Methods.Rmd</code></a></small>
      <div class="d-none name"><code>Adding_New_Methods.Rmd</code></div>
    </div>

    
    
<p>This vignette explains how to add new publication bias correction
methods to the <code>PublicationBiasBenchmark</code> package. We’ll use
the PET (Precision-Effect Test) method as an example.</p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Each method in the package consists of three key components:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Main method function</strong>: Implements the statistical
method</li>
<li>
<strong>Settings function</strong>: Defines available method
configurations<br>
</li>
<li>
<strong>Extra columns function</strong>: Specifies additional result
columns</li>
</ol>
<p>All three functions must be implemented in a single file named
<code>method-{METHOD_NAME}.R</code> in the <code>R/</code>
directory.</p>
</div>
<div class="section level2">
<h2 id="file-structure-and-naming">File Structure and Naming<a class="anchor" aria-label="anchor" href="#file-structure-and-naming"></a>
</h2>
<p>For a method called “PET”, you need to create a file named
<code>R/method-PET.R</code> containing three functions:</p>
<ul>
<li>
<code><a href="../reference/method.PET.html">method.PET()</a></code> - The main implementation</li>
<li>
<code>method_settings.PET()</code> - Available
settings/configurations</li>
<li>
<code>method_extra_columns.PET()</code> - Additional result
columns</li>
</ul>
<p>The naming pattern is crucial for the package’s S3 method dispatch
system to work correctly.</p>
</div>
<div class="section level2">
<h2 id="main-method-function-method-method_name">1. Main Method Function: <code>method.{METHOD_NAME}()</code><a class="anchor" aria-label="anchor" href="#main-method-function-method-method_name"></a>
</h2>
<p>This is the core function that implements your statistical method.
Here’s the PET implementation as an example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title PET (Precision-Effect Test) Method</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @description</span></span>
<span><span class="co">#' Implements the Precision-Effect Test for publication bias correction.</span></span>
<span><span class="co">#' PET regresses effect sizes against standard errors to test for and correct</span></span>
<span><span class="co">#' publication bias. The intercept represents the bias-corrected effect size</span></span>
<span><span class="co">#' estimate.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param method_name Method name (automatically passed)</span></span>
<span><span class="co">#' @param data Data frame with yi (effect sizes) and sei (standard errors)</span></span>
<span><span class="co">#' @param settings List of method settings</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return Data frame with PET results</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">method.PET</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">method_name</span>, <span class="va">data</span>, <span class="va">settings</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Extract data</span></span>
<span>  <span class="va">effect_sizes</span>    <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">yi</span></span>
<span>  <span class="va">standard_errors</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">sei</span></span>
<span>  </span>
<span>  <span class="co"># Input validation and error handling</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">effect_sizes</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"At least 3 estimates required for PET analysis"</span>, call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">standard_errors</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"No variance in standard errors"</span>, call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Implement the statistical method</span></span>
<span>  <span class="va">pet_model</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">effect_sizes</span> <span class="op">~</span> <span class="va">standard_errors</span>, </span>
<span>                        weights <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">standard_errors</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Extract and process results</span></span>
<span>  <span class="va">coefficients</span>    <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">pet_model</span><span class="op">)</span></span>
<span>  <span class="va">se_coefficients</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pet_model</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span>, <span class="st">"Std. Error"</span><span class="op">]</span></span>
<span>  <span class="va">p_values</span>        <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pet_model</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span>, <span class="st">"Pr(&gt;|t|)"</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Main estimates</span></span>
<span>  <span class="va">estimate</span>    <span class="op">&lt;-</span> <span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>  <span class="co"># Intercept = bias-corrected effect</span></span>
<span>  <span class="va">estimate_se</span> <span class="op">&lt;-</span> <span class="va">se_coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">estimate_p</span>  <span class="op">&lt;-</span> <span class="va">p_values</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Additional method-specific results</span></span>
<span>  <span class="va">bias_coefficient</span> <span class="op">&lt;-</span> <span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">bias_p_value</span>     <span class="op">&lt;-</span> <span class="va">p_values</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Calculate confidence intervals</span></span>
<span>  <span class="va">estimate_lci</span> <span class="op">&lt;-</span> <span class="va">estimate</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">estimate_se</span></span>
<span>  <span class="va">estimate_uci</span> <span class="op">&lt;-</span> <span class="va">estimate</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">estimate_se</span></span>
<span>  </span>
<span>  <span class="co"># Return standardized results</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    method         <span class="op">=</span> <span class="va">method_name</span>,</span>
<span>    estimate       <span class="op">=</span> <span class="va">estimate</span>,</span>
<span>    standard_error <span class="op">=</span> <span class="va">estimate_se</span>,</span>
<span>    ci_lower       <span class="op">=</span> <span class="va">estimate_lci</span>,</span>
<span>    ci_upper       <span class="op">=</span> <span class="va">estimate_uci</span>,</span>
<span>    p_value        <span class="op">=</span> <span class="va">estimate_p</span>,</span>
<span>    BF             <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    convergence    <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    note           <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    <span class="co"># Method-specific columns</span></span>
<span>    bias_coefficient <span class="op">=</span> <span class="va">bias_coefficient</span>,</span>
<span>    bias_p_value     <span class="op">=</span> <span class="va">bias_p_value</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level3">
<h3 id="key-requirements-for-the-main-function">Key Requirements for the Main Function:<a class="anchor" aria-label="anchor" href="#key-requirements-for-the-main-function"></a>
</h3>
<p><strong>Input Parameters:</strong></p>
<ul>
<li>
<code>method_name</code>: Automatically passed by the framework</li>
<li>
<code>data</code>: Data frame with <code>yi</code> (effect sizes),
<code>sei</code> (standard errors), and <code>ni</code> (sample
sizes).</li>
<li>
<code>settings</code>: Optional list of method-specific
settings</li>
</ul>
<p>Some data generating mechanisms may provide additional information in
the <code>data</code> argument. If your method can utilize this
information, you should implement additional input check and dispatch
logic. Those additional columns might include:</p>
<ul>
<li>
<code>study_id</code>: Unique identifier for each study/cluster (in
the presence of multilevel/clustered data)</li>
<li>
<code>es_type</code>: Type of standardized effect size (e.g., “SMD”,
“logOR”, “none”)</li>
</ul>
<p><strong>Output:</strong> Must return a data frame with these
<strong>required columns</strong>:</p>
<ul>
<li>
<code>method</code>: Method name</li>
<li>
<code>estimate</code>: Meta-analytic effect size estimate</li>
<li>
<code>standard_error</code>: Standard error of the estimate</li>
<li>
<code>ci_lower</code>: Lower confidence interval bound (95%)</li>
<li>
<code>ci_upper</code>: Upper confidence interval bound (95%)</li>
<li>
<code>p_value</code>: P-value for the estimate</li>
<li>
<code>BF</code>: Bayes factor for the estimate</li>
<li>
<code>convergence</code>: Logical indicating successful
convergence</li>
<li>
<code>note</code>: Character string with notes</li>
</ul>
<p>If your method does not provide certain values (e.g., Bayes factor),
use <code>NA</code>.</p>
<p><strong>Error Handling:</strong></p>
<ul>
<li>Include input validation and meaningful error messages</li>
<li>Use <code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code> with <code>call. = FALSE</code> for
user-friendly errors</li>
<li>The framework handles errors automatically - your function can throw
errors. The package will catch the errors and attach them to an empty
output with <code>convergence = FALSE</code> and the error message in
<code>note</code>.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="settings-function-method_settings-method_name">2. Settings Function:
<code>method_settings.{METHOD_NAME}()</code><a class="anchor" aria-label="anchor" href="#settings-function-method_settings-method_name"></a>
</h2>
<p>This function defines the available configurations for your
method:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @export</span></span>
<span><span class="va">method_settings.PET</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">method_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">settings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"default"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># PET has no configurable settings</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">settings</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The selected settings are passed to your main function as the
<code>settings</code> parameter. There, the main function can use these
settings to adjust its behavior. Once defined, these settings cannot be
changed retrospectively to ensure reproducibility and continuity of the
benchmark.</p>
<p>For an example of a method that defines several settings we can
examine the random effects meta-analysis (RMA) method:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example with multiple settings (from RMA method)</span></span>
<span><span class="va">method_settings.RMA</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">method_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">settings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"default"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      method <span class="op">=</span> <span class="st">"REML"</span>, </span>
<span>      test.uni <span class="op">=</span> <span class="st">"knha"</span>, </span>
<span>      test.mv <span class="op">=</span> <span class="st">"t"</span>, </span>
<span>      control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>stepadj <span class="op">=</span> <span class="fl">0.5</span>, maxiter <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">settings</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="extra-columns-function-method_extra_columns-method_name">3. Extra Columns Function:
<code>method_extra_columns.{METHOD_NAME}()</code><a class="anchor" aria-label="anchor" href="#extra-columns-function-method_extra_columns-method_name"></a>
</h2>
<p>This function specifies additional columns that your method returns
beyond the required ones:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @export</span></span>
<span><span class="va">method_extra_columns.PET</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">method_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bias_coefficient"</span>, <span class="st">"bias_p_value"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The column names must match exactly the additional columns that your
main function returns. These columns will be included in the final
output data frame alongside the required columns and guarantee that the
results can be merged in case the method fails with an error.</p>
<p>Use <code>character(0)</code> or <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> if your method has
no extra columns</p>
</div>
<div class="section level2">
<h2 id="using-your-new-method">Using Your New Method<a class="anchor" aria-label="anchor" href="#using-your-new-method"></a>
</h2>
<p>Once implemented, your method can be used through the unified
interface:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create example data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  yi  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.4</span>, <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>  sei <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.08</span>, <span class="fl">0.12</span>, <span class="fl">0.09</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run your method</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_method.html">run_method</a></span><span class="op">(</span><span class="st">"PET"</span>, <span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use specific settings (if available)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_method.html">run_method</a></span><span class="op">(</span><span class="st">"PET"</span>, <span class="va">data</span>, <span class="st">"default"</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by František Bartoš, Samuel Pawel, Björn S. Siepe.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
